<img src="https://images.unsplash.com/photo-1556611832-c5f358b0057e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1650&q=80" class="w-50">
<div class="container d-flex justify-content-around">
  <div class="storage">
    <div class="storage-content">
      <h1><%= @storage.title %></h1>
      <p> the storage is located it the <%= @storage.address %> district</p>
      <p>Price: <%= @storage.price %> € / month</p>
      <p>Volume: <%= @storage.sqm %> sqm</p>
      <p>Description: <%= @storage.description %></p>
    </div>
    <%= cl_image_tag current_user.photo, id: "user_photo" %>
    <%= link_to 'My storages', my_storages_path, class: "btn" %>
    <% if policy(@storage).edit? %>
      <%= link_to 'Edit ✏️', edit_storage_path(@storage), class: "btn" %>
    <% end %>

    <% if policy(@storage).destroy? %>
      <%= link_to 'Delete 🗑', @storage, method: :delete, data: { confirm: 'Are you sure?'}, class: "btn" %>
    <% end %>
  </div>


    <% if @storage.user == current_user %>
    <div class="card-booking">
      <h3 class="text-center mb-3">Upcoming Bookings</h3>
      <% @storage.bookings.each do |booking| %>
      <div class="card-booking-infos">
        <p class="mt-2"><strong>Guest:</strong> <%= booking.user.first_name %> <%= booking.user.last_name %></p>
        <p><strong>Status:</strong> <%= booking.status %></p>
        <% if booking.status == 'pending' %>
          <p><%= link_to 'Accept', approved_path(booking), method: :patch %></p>
          <p><%= link_to 'Decline', denied_path(booking), method: :patch %></p>
        <% end %>
        <p><strong>Price:</strong> <%= booking.total_price %> €</p>
        <p><strong>Check-in:</strong> <%= booking.start_date.to_formatted_s(:long) %> </p>
        <p><strong>Check-out:</strong> <%= booking.end_date.to_formatted_s(:long) %> </p>
        <p><strong>Duration:</strong> <%= (booking.end_date - booking.start_date).to_i %> days</p>
        <p class="mb-2"><strong>Belongs to:</strong> <%= booking.storage.user.first_name.capitalize %> </p>
        <br>
      </div>
      <% end %>
    </div>


    <% else %>
    <div class="form border border-dark p-5">
      <%= simple_form_for [@storage, @booking] do |f| %>
        <h3>Book this storage</h3>
        <p><%= f.input :start_date, label: "Check-in" %></p>
        <p><%= f.input :end_date, label: "Check-out"  %></p>
        <%= f.button :submit, class: "btn-book w-100 mt-3 mb-0" %>
      <% end %>
    </div>
    <% end %>
</div>
